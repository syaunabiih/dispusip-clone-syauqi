<%- include('partials/header', { title: 'Daftar Kategori', active: 'category' }) %>

<h1 class="text-2xl font-bold mb-6">Daftar Kategori</h1>

<!-- SEARCH -->
<form action="/admin/categories" method="GET" class="mb-6 flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
    <input 
        type="text" 
        name="q" 
        value="<%= typeof q !== 'undefined' ? q : '' %>" 
        placeholder="Cari kategori..." 
        class="border p-2 rounded flex-1"
    >
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 whitespace-nowrap">
        Cari
    </button>
</form>

<div class="flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-4 mb-4">
    <h1 class="text-xl sm:text-2xl font-bold">Daftar Kategori</h1>

    <button 
        onclick="openAddModal()"
        class="w-full sm:w-auto bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 whitespace-nowrap">
        âž• Tambah Kategori
    </button>
</div>

<!-- TABEL -->
<div class="overflow-x-auto">
<table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
    <thead class="bg-gray-100 text-left">
        <tr>
            <th class="p-2 sm:p-4">No</th>
            <th class="p-2 sm:p-4">Nama Kategori</th>
            <th class="p-2 sm:p-4">Aksi</th>
        </tr>
    </thead>

    <tbody>
        <% if (categories.length === 0) { %>
            <tr>
                <td colspan="3" class="p-4 text-center text-gray-500">
                    Belum ada kategori.
                </td>
            </tr>
        <% } else { %>
            <% categories.forEach((category, index) => { %>
                <tr class="border-t hover:bg-gray-50">
                    <td class="p-2 sm:p-4 text-sm sm:text-base"><%= index + 1 %></td>
                    <td class="p-2 sm:p-4 text-sm sm:text-base"><%= category.name %></td>
                    <td class="p-2 sm:p-4 text-sm sm:text-base">
                        <button
                            onclick="openEditModal('<%= category.id %>', '<%= category.name %>')"
                            class="text-blue-600 hover:underline">
                            Edit
                        </button>
                        |
                        <a 
                            href="/admin/categories/delete/<%= category.id %>" 
                            onclick="return confirm('Apakah yakin ingin menghapus kategori ini?');"
                            class="text-red-600 hover:underline"
                        >
                            Hapus
                        </a>
                    </td>
                </tr>
            <% }) %>
        <% } %>
    </tbody>
</table>
</div>

<!-- MODAL ADD -->
<div id="addModal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg w-full max-w-md p-4 sm:p-6">
        <h2 class="text-lg font-bold mb-4">Tambah Kategori</h2>

        <form action="/admin/categories/add" method="POST">
            <input 
                type="text" 
                name="name" 
                required
                placeholder="Nama kategori"
                class="w-full border p-2 rounded mb-4">

            <div class="flex flex-col sm:flex-row justify-end gap-2">
                <button type="button" onclick="closeAddModal()" class="w-full sm:w-auto px-4 py-2 border rounded transition-colors">
                    Batal
                </button>
                <button type="submit" class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded transition-colors">
                    Simpan
                </button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL EDIT -->
<div id="editModal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg w-full max-w-md p-4 sm:p-6">
        <h2 class="text-lg font-bold mb-4">Edit Kategori</h2>

        <form id="editForm" method="POST">
            <input 
                type="text" 
                name="name" 
                id="editName"
                required
                class="w-full border p-2 rounded mb-4">

            <div class="flex flex-col sm:flex-row justify-end gap-2">
                <button type="button" onclick="closeEditModal()" class="w-full sm:w-auto px-4 py-2 border rounded transition-colors">
                    Batal
                </button>
                <button type="submit" class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded transition-colors">
                    Update
                </button>
            </div>
        </form>
    </div>
</div>

<%- include('partials/footer') %>

<script>
    const addModal = document.getElementById('addModal');
    const editModal = document.getElementById('editModal');
    const editForm = document.getElementById('editForm');
    const editName = document.getElementById('editName');

    function openAddModal() {
        addModal.classList.remove('hidden');
        addModal.classList.add('flex');
    }

    function closeAddModal() {
        addModal.classList.add('hidden');
        addModal.classList.remove('flex');
    }

    function openEditModal(id, name) {
        editForm.action = `/admin/categories/edit/${id}`;
        editName.value = name;

        editModal.classList.remove('hidden');
        editModal.classList.add('flex');
    }

    function closeEditModal() {
        editModal.classList.add('hidden');
        editModal.classList.remove('flex');
    }
</script>