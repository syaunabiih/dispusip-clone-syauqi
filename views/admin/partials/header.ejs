<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= typeof title !== 'undefined' ? title : 'Admin Panel' %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex">

    <% 
        // Helper variables
        const safeActive = typeof active !== 'undefined' ? active : '';
        const safeTitle = typeof title !== 'undefined' ? title : '';
    %>

    <header class="fixed top-0 left-0 right-0 h-14 sm:h-16 bg-white shadow z-40 flex items-center justify-between px-3 sm:px-4">
        <div class="flex items-center flex-1 min-w-0">
            <button id="toggleSidebar"
                class="bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 text-sm sm:text-base flex-shrink-0 transition-colors">
                â˜°
            </button>

            <div class="ml-2 sm:ml-4 flex flex-col min-w-0">
                <h1 class="text-sm sm:text-lg font-bold truncate text-gray-800 leading-tight">
                    <%= safeTitle %>
                </h1>
                
                <% if (typeof namaRuangan !== 'undefined' && namaRuangan) { %>
                    <p class="text-[10px] sm:text-xs text-blue-600 font-bold uppercase tracking-wider truncate">
                        <i class="fas fa-map-marker-alt mr-1"></i> <%= namaRuangan %>
                    </p>
                <% } %>
            </div>
        </div>
        
        <a href="/admin/logout"
            class="lg:hidden bg-red-500 text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded-md hover:bg-red-600 transition duration-200 text-xs sm:text-sm font-semibold flex items-center gap-1 flex-shrink-0 ml-2">
            <span class="hidden sm:inline">Logout</span>
            <i class="fas fa-sign-out-alt sm:hidden"></i>
        </a>
    </header>

    <aside id="sidebar"
        class="w-64 bg-white h-screen shadow-lg fixed flex flex-col justify-between
                transform transition-transform duration-300 ease-in-out z-30
                -translate-x-full overflow-y-auto">
        <div class="flex-1 min-h-0">
            <div class="p-4 sm:p-6 border-b">
                <h1 class="text-base sm:text-lg font-bold text-blue-600">Admin Panel</h1>
            </div>

            <nav class="mt-2 sm:mt-4">

                <% if (typeof user !== 'undefined' && user.nama_ruangan === 'Ruangan Pustaka Keliling') { %>
                    
                    <a href="/admin/puskel" 
                        class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base 
                        <%= typeof active !== 'undefined' && active === 'logistik' ? 'font-semibold text-blue-700 bg-blue-50 border-r-4 border-blue-600' : 'text-gray-700' %>">
                        <i class="fas fa-truck-loading mr-2 w-5 text-center"></i> Buku Puskel
                    </a>

                    <a href="/admin/puskel/borrowers" 
                        class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base 
                        <%= typeof active !== 'undefined' && active === 'borrowers' ? 'font-semibold text-blue-700 bg-blue-50 border-r-4 border-blue-600' : 'text-gray-700' %>">
                        <i class="fas fa-users mr-2 w-5 text-center"></i> Data Peminjam
                    </a>

                    <a href="/admin/puskel/history" 
                        class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base 
                        <%= typeof active !== 'undefined' && active === 'puskel_history' ? 'font-semibold text-blue-700 bg-blue-50 border-r-4 border-blue-600' : 'text-gray-700' %>">
                        <i class="fas fa-history mr-2 w-5 text-center"></i> Riwayat Peminjaman
                    </a>

                <% } else { %>
                    
                    <a href="/admin/dashboard" class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base 
                        <%= safeActive === 'dashboard' || safeTitle === 'Dashboard Statistik' ? 'bg-blue-100 font-semibold' : '' %>">
                        ğŸ“Š Dashboard
                    </a>
                    
                    <a href="/admin/books" class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base <%= safeActive === 'home' || safeTitle === 'Daftar Buku' ? 'bg-blue-100 font-semibold' : '' %>">
                        ğŸ“š Daftar Buku
                    </a>

                    <a href="/admin/books/add" class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base <%= safeActive === 'add' ? 'bg-blue-100 font-semibold' : '' %>">
                        â• Tambah Buku
                    </a>

                    <a href="/admin/categories"
                        class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base
                        <%= safeActive === 'categories' || safeTitle === 'Kelola Kategori' ? 'bg-blue-100 font-semibold' : '' %>">
                        ğŸ“‚ Daftar Kategori
                    </a>

                    <a href="/admin/subjects"
                        class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base <%= safeActive === 'subject' || safeTitle === 'Kelola Subjek' ? 'bg-blue-100 font-semibold' : '' %>">
                        ğŸ·ï¸ Subjek
                    </a>

                    <a href="/admin/authors"
                        class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base <%= safeActive === 'authors' || safeTitle === 'Kelola Penulis' ? 'bg-blue-100 font-semibold' : '' %>">
                        âœï¸ Penulis
                    </a>

                    <a href="/admin/publishers"
                        class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base <%= safeActive === 'publishers' || safeTitle === 'Kelola Penerbit' ? 'bg-blue-100 font-semibold' : '' %>">
                        ğŸ¢ Penerbit
                    </a>
                    <a href="/admin/shelf-management"
                        class="block px-4 sm:px-6 py-2 sm:py-3 hover:bg-blue-50 text-sm sm:text-base <%= safeActive === 'shelf-management' ? 'bg-blue-100 font-semibold' : '' %>">
                        ğŸ“ Manajemen Rak
                    </a>
                <% } %>
                </nav>
        </div>

        <div class="mb-4 sm:mb-6 px-4 sm:px-6 hidden lg:block">
            <a href="/admin/logout"
            class="w-full block py-2 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition duration-200 text-center text-sm sm:text-base">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </a>
        </div>
    </aside>

    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden" onclick="toggleSidebar()"></div>

    <main id="mainContent"
        class="lg:ml-64 w-full p-4 sm:p-6 lg:p-8 transition-all duration-300 mt-14 sm:mt-16">