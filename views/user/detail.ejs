<%- include('partials/header') %>

<link rel="stylesheet" href="/css/style.css">

<div class="w-[90%] mx-auto">

    <div class="text-sm breadcrumbs text-gray-500 mb-6">
        <a href="/" class="hover:text-blue-600">Home</a> 
        <span class="mx-2">/</span> 
        <span class="text-gray-700">Detail Result</span>
        <span class="mx-2">/</span>
        <span class="font-medium text-gray-900"><%= book.title %></span>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
        
        <!-- KOLOM KIRI: COVER (3/12) -->
        <div class="lg:col-span-3">
            <div class="bg-white p-2 border border-gray-300 shadow-sm inline-block w-full">
                <div class="w-full aspect-[3/4] border border-gray-200 bg-gray-50 flex items-center justify-center">
                    <% if (book.image) { %>
                        <img src="/image/uploads/<%= book.image %>" alt="Cover Buku" class="img-fluid">
                    <% } else { %>
                        <div class="text-center text-gray-400">
                            <h1 class="text-2xl font-serif leading-tight">SAMPUL<br>BELUM<br>TERSEDIA</h1>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- KOLOM TENGAH: DETAIL & PETA (6/12) -->
        <div class="lg:col-span-6 space-y-8">
            
            <!-- Tabel Detail Buku -->
            <div>

                <!-- TABEL DATA BUKU -->
                <div class="bg-white border-t-2 border-blue-600 shadow-sm">
                    <table class="w-full text-sm text-left">
                        <tbody>
                            <tr class="bg-blue-50/50 border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600 w-1/3">Kategori</td>
                                <td class="px-4 py-2 text-gray-800"><%= book.category %></td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Judul</td>
                                <td class="px-4 py-2 font-bold text-gray-900"><%= book.title %></td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Pengarang</td>
                                <td class="px-4 py-2">
                                    <span class="text-gray-800 block"><%= book.author %> (penulis)</span>
                                    <% if(book.additional_author) { %>
                                        <span class="text-gray-800 block"><%= book.additional_author %></span>
                                    <% } %>
                                </td>
                            </tr>
                            <tr class="bg-blue-50/50 border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Edisi</td>
                                <td class="px-4 py-2 text-gray-800"><%= book.edition || '-' %></td>
                            </tr>
                            <tr class="bg-blue-50/50 border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Penerbitan</td>
                                <td class="px-4 py-2 text-gray-800">
                                    <%= book.publish_place || '[Tempat tidak diketahui]' %> : 
                                    <%= book.publisher || '[Penerbit tidak diketahui]' %>, 
                                    <%= book.publish_year %>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Deskripsi Fisik</td>
                                <td class="px-4 py-2 text-gray-800"><%= book.physical_description || '-' %></td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">ISBN</td>
                                <td class="px-4 py-2 text-gray-800"><%= book.isbn || '-' %></td>
                            </tr>
                            <tr class="bg-blue-50/50 border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Subjek</td>
                                <td class="px-4 py-2 text-gray-800"><%= book.subject || '-' %></td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600 align-top">Abstrak</td>
                                <td class="px-4 py-2 text-gray-800 text-justify leading-relaxed">
                                    <%= book.abstract || '-' %>
                                </td>
                            </tr>
                            <tr class="bg-blue-50/50 border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Catatan</td>
                                <td class="px-4 py-2 text-gray-800"><%= book.notes || '-' %></td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Bahasa</td>
                                <td class="px-4 py-2 text-gray-800"><%= book.language %></td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Stok</td>
                                <td class="px-4 py-2 text-gray-800">
                                    <%= book.total_books %> tersedia dari total <%= book.stock_total %> eks.
                                </td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="px-4 py-2 font-semibold text-gray-600">Lokasi Rak</td>
                                <td class="px-4 py-2 text-gray-800 font-bold">
                                    <%= book.shelf_location || 'Umum' %>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tabel Ketersediaan Eksemplar -->
            <div class="bg-white border border-gray-200 shadow-sm">
                <div class="bg-blue-800 text-white px-4 py-2 font-semibold text-sm">
                    Ketersediaan Eksemplar
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left min-w-[600px]">
                        <thead class="bg-gray-50 text-blue-800 font-bold border-b border-gray-200">
                            <tr>
                                <th class="p-3 border-r">No. Induk</th>
                                <th class="p-3 border-r">Judul Buku</th>
                                <th class="p-3 border-r">Lokasi</th>
                                <th class="p-3">Status</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 bg-blue-50/20">
                            <% if (copies && copies.length > 0) { %>
                                <% copies.forEach(copy => { %>
                                    <tr>
                                        <td class="p-3 border-r text-blue-800 font-mono"><%= copy.no_induk %></td>
                                        <td class="p-3 border-r text-gray-800 font-medium leading-tight"><%= copy.title %></td>
                                        <td class="p-3 border-r text-gray-700">
                                            <span class="block font-medium"><%= copy.location %></span>
                                        </td>
                                        <td class="p-3 text-gray-700">
                                            <% if (copy.status === 'tersedia') { %>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    Tersedia
                                                </span>
                                            <% } else if (copy.status === 'dipinjam') { %>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                    Dipinjam
                                                </span>
                                            <% } else if (copy.status === 'rusak') { %>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                    Rusak
                                                </span>
                                            <% } else if (copy.status === 'hilang') { %>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-200 text-gray-700">
                                                    Hilang
                                                </span>
                                            <% } else { %>
                                                <span class="text-xs text-gray-600"><%= copy.status %></span>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="4" class="p-4 text-center text-gray-500 text-sm italic">Data eksemplar belum tersedia.</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                <div class="px-4 py-2 text-right text-xs text-gray-500 border-t border-gray-200">
                    <% if (copies && copies.length > 0) { %>
                        Menampilkan <%= copies.length %> eksemplar
                    <% } else { %>
                        Tidak ada data eksemplar
                    <% } %>
                </div>
            </div>

            <!-- PANGGIL PARTIAL DENAH -->
            <%- include('partials/shelfMap', { shelfLocation: book.shelf_location }) %>

        </div>

        <!-- KOLOM KANAN: QR CODE & KARYA TERKAIT (3/12) -->
        <div class="lg:col-span-3 space-y-6">
            
            <!-- WIDGET QR CODE -->
            <!-- <div class="bg-white border border-blue-200 rounded overflow-hidden shadow-sm">
                <div class="bg-blue-50 px-3 py-2 border-b border-blue-100">
                    <h4 class="text-sm font-bold text-blue-800 flex items-center">
                        <i class="fas fa-qrcode mr-2"></i> Simpan Info Buku
                    </h4>
                </div>
                <div class="p-4 flex flex-col items-center text-center">
                    <div class="bg-white p-2 border rounded mb-3">
                        <% if (typeof qrImage !== 'undefined' && qrImage) { %>
                            <img src="<%= qrImage %>" alt="QR Code" class="w-32 h-32 block mx-auto">
                        <% } else { %>
                            <div class="w-32 h-32 bg-gray-100 flex items-center justify-center text-xs text-gray-400">
                                QR Error
                            </div>
                        <% } %>
                    </div>
                    <p class="text-xs text-gray-600 mb-3 leading-relaxed">
                        Scan untuk menyimpan<br>Judul & No. Panggil.
                    </p>
                    <button onclick="window.print()" 
                        class="w-full text-xs bg-gray-50 hover:bg-gray-100 text-gray-700 px-3 py-2 rounded border border-gray-300">
                        <i class="fas fa-print mr-2"></i> Cetak Info Buku
                    </button>
                </div>
            </div> -->

            <!-- WIDGET KARYA TERKAIT -->
            <div class="bg-white border border-gray-300 rounded overflow-hidden shadow-sm">
                <div class="bg-blue-800 text-white px-3 py-2 font-bold text-sm flex justify-between">
                    <span>Karya Terkait</span>
                    <i class="fas fa-chevron-up"></i>
                </div>
                <div class="divide-y divide-gray-200">
                    <% if(relatedBooks.length > 0) { %>
                        <% relatedBooks.forEach(rel => { %>
                            <div class="p-3 hover:bg-gray-50 text-sm group">
                                <a href="/book/<%= rel.id %>" class="text-blue-700 group-hover:underline block mb-1 leading-tight font-medium"><%= rel.title %></a>
                                <span class="text-gray-500 text-xs block"><%= rel.author %></span>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <div class="p-4 text-xs text-gray-500 text-center italic">Tidak ada karya terkait.</div>
                    <% } %>
                    <div class="p-2 bg-gray-50 text-right border-t border-gray-200">
                        <a href="#" class="text-xs text-blue-600 hover:underline font-medium">Lihat lebih banyak..</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB BAGIAN BAWAH
    <div class="mt-8">
        
        <div class="border border-gray-200 p-6 bg-white shadow-sm mt-[-1px]">
            Search Bar Eksemplar
            <div class="flex flex-col sm:flex-row justify-end mb-4 gap-2">
                <select class="border border-gray-300 rounded text-sm p-1.5 text-gray-600 focus:outline-none focus:border-blue-500">
                    <option>Nomor Barcode</option>
                    <option>No. Panggil</option>
                </select>
                <div class="flex">
                    <input type="text" class="border border-gray-300 border-r-0 rounded-l p-1.5 text-sm w-40 focus:outline-none focus:border-blue-500">
                    <button class="bg-gray-50 border border-gray-300 rounded-r px-3 text-sm text-gray-600 hover:bg-gray-100">Cari</button>
                </div>
            </div>

            Tabel Eksemplar
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left border border-gray-200 min-w-[600px]">
                    <thead class="bg-gray-50 text-blue-800 font-bold border-b border-gray-200">
                        <tr>
                            <th class="p-3 border-r">No. Barcode</th>
                            <th class="p-3 border-r">No. Panggil</th>
                            <th class="p-3 border-r">Akses</th>
                            <th class="p-3 border-r">Lokasi</th>
                            <th class="p-3">Ketersediaan</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 bg-blue-50/20">
                        <tr>
                            <td class="p-3 border-r text-blue-800 font-mono">B00<%= book.id %>123</td>
                            <td class="p-3 border-r text-gray-700 font-mono font-bold"><%= book.call_number %></td>
                            <td class="p-3 border-r text-gray-700">Baca di tempat</td>
                            <td class="p-3 border-r text-gray-700">
                                <span class="block font-medium">Perpustakaan Pusat</span>
                                <span class="text-xs text-gray-500">Koleksi Referensi</span>
                            </td>
                            <td class="p-3 text-gray-700">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    Tersedia
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="mt-4 text-right text-xs text-gray-500 border-t pt-2">
                Halaman ke-1 dari 1 (1 data)
            </div>
        </div>
    </div> -->

    <!-- PRINT LAYOUT (Hanya tampil ketika dicetak) -->
    <div id="print-area" class="hidden print:block p-6">
        <div class="border border-gray-300 p-4 rounded">
            
            <!-- HEADER -->
            <h2 class="text-xl font-bold text-center mb-4">Informasi Buku</h2>

            <div class="grid grid-cols-12 gap-4">
                
                <!-- COVER -->
                <div class="col-span-4">
                    <% if (book.image) { %>
                        <img src="/image/uploads/<%= book.image %>" class="w-full border" />
                    <% } else { %>
                        <div class="w-full h-48 bg-gray-200 flex items-center justify-center text-gray-500 border">
                            Sampul Tidak Tersedia
                        </div>
                    <% } %>
                </div>

                <!-- DETAIL -->
                <div class="col-span-8">
                    <table class="w-full text-sm">
                        <tr><td class="font-bold w-32">Kategori</td><td><%= book.category %></td></tr>
                        <tr><td class="font-bold">Judul</td><td><%= book.title %></td></tr>
                        <tr><td class="font-bold">Judul Asli</td><td><%= book.original_title || '-' %></td></tr>
                        <tr><td class="font-bold">Pengarang</td><td><%= book.author %></td></tr>
                        <tr><td class="font-bold">Edisi</td><td><%= book.edition || '-' %></td></tr>
                        <tr><td class="font-bold">Penerbit</td>
                            <td>
                                <%= book.publish_place || '-' %> :
                                <%= book.publisher || '-' %>,
                                <%= book.publish_year || '-' %>
                            </td>
                        </tr>
                        <tr><td class="font-bold">ISBN</td><td><%= book.isbn || '-' %></td></tr>
                        <tr><td class="font-bold">Bahasa</td><td><%= book.language %></td></tr>
                        <tr><td class="font-bold">Stok</td>
                            <td><%= book.stock_available %> dari <%= book.stock_total %> eks</td>
                        </tr>
                        <tr><td class="font-bold">Lokasi Rak</td><td><%= book.shelf_location %></td></tr>
                    </table>
                </div>
            </div>

            <!-- ABSTRAK -->
            <h3 class="mt-4 font-bold text-gray-700">Abstrak</h3>
            <p class="text-sm text-gray-800 leading-relaxed"><%= book.abstract || '-' %></p>

            <!-- QR -->
            <div class="mt-4 flex items-center gap-4">
                <div>
                    <% if (qrImage) { %>
                        <img src="<%= qrImage %>" class="w-28 h-28 border p-1" />
                    <% } %>
                </div>
                <div class="text-sm text-gray-700">
                    Scan untuk menyimpan informasi buku.
                </div>
            </div>
        </div>
    </div>

</div>

<%- include('partials/footer') %>